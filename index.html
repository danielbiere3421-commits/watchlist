<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ma Watchlist</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#000;
  color:white;
  overflow:hidden;
}

#topbar{
  position:fixed;
  top:0;
  width:100%;
  background:rgba(0,0,0,0.85);
  padding:12px;
  backdrop-filter:blur(12px);
  z-index:10;
}

input{
  width:65%;
  padding:12px;
  border-radius:25px;
  border:none;
  font-size:16px;
}

button{
  padding:12px 16px;
  border:none;
  border-radius:25px;
  font-size:14px;
  cursor:pointer;
}

.search-btn{ background:#1db954; color:white; }

.results{
  display:flex;
  overflow-x:auto;
  margin-top:10px;
}

.results img{
  height:130px;
  border-radius:12px;
  margin-right:10px;
  cursor:pointer;
  transition:transform 0.2s;
}

.results img:hover{
  transform:scale(1.05);
}

#viewer{
  position:relative;
  width:100vw;
  height:100vh;
  overflow:hidden;
}

.poster{
  position:absolute;
  width:100%;
  height:100%;
  object-fit:cover;
  transition:transform 0.4s ease, opacity 0.4s ease;
}

.overlay{
  position:fixed;
  bottom:20px;
  width:100%;
  text-align:center;
}

.controls{
  display:flex;
  justify-content:center;
  gap:12px;
}

.control-btn{
  background:rgba(0,0,0,0.6);
  color:white;
  font-size:18px;
  padding:16px;
  border-radius:50%;
}

.status{
  position:fixed;
  top:75px;
  right:15px;
  padding:8px 14px;
  border-radius:20px;
  font-size:14px;
  font-weight:bold;
}

.watched{ background:#1db954; }
.not-watched{ background:#e50914; }

/* DELORAN */
.delorean{
  position:fixed;
  top:-250px;
  left:50%;
  transform:translateX(-50%);
  width:150px;
  z-index:9998;
  transition:top 1.2s cubic-bezier(.17,.67,.83,.67);
  cursor:pointer;
}

.fire{
  position:fixed;
  bottom:0;
  width:20px;
  height:120px;
  background:linear-gradient(to top, orange, yellow, transparent);
  animation:flame 0.3s infinite alternate;
  z-index:9997;
}

@keyframes flame{
  from{height:100px;}
  to{height:140px;}
}

.flash{
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  animation:flashAnim 0.4s ease;
  z-index:9996;
}

@keyframes flashAnim{
  0%{opacity:0;}
  50%{opacity:0.8;}
  100%{opacity:0;}
}

.blur{
  filter:blur(8px);
  transition:filter 0.4s ease;
}

.message{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:rgba(0,0,0,0.9);
  padding:30px 40px;
  border-radius:20px;
  font-size:22px;
  z-index:10000;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="topbar">
  <input id="title" placeholder="Ajouter un film...">
  <button class="search-btn" onclick="searchMovie()">+</button>
  <div class="results" id="results"></div>
</div>

<div id="viewer"></div>
<div id="status"></div>

<div class="overlay">
  <div class="controls">
    <button class="control-btn" onclick="prev()">â—€</button>
    <button class="control-btn" onclick="toggleWatched()">âœ“</button>
    <button class="control-btn" onclick="removeMovie()">ðŸ—‘</button>
    <button class="control-btn" onclick="next()">â–¶</button>
  </div>
</div>

<script>
const apiKey = "410d347b";
let movies = JSON.parse(localStorage.getItem("movies")) || [];
let currentIndex = 0;
let startX = 0;

async function searchMovie(){
  const title = document.getElementById("title").value;
  const res = await fetch(`https://www.omdbapi.com/?s=${title}&apikey=${apiKey}`);
  const data = await res.json();
  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "";

  if(data.Search){
    data.Search.forEach(movie=>{
      if(movie.Poster !== "N/A"){
        const img = document.createElement("img");
        img.src = movie.Poster.replace("SX300","SX1000");
        img.onclick = ()=>addMovie(movie);
        resultsDiv.appendChild(img);
      }
    });
  }
}

function addMovie(movie){
  movie.Poster = movie.Poster.replace("SX300","SX1000");
  movie.watched = false;
  movies.push(movie);
  save();
  render();
}

function render(){
  if(!movies.length){
    document.getElementById("viewer").innerHTML="";
    document.getElementById("status").innerHTML="";
    return;
  }

  const viewer = document.getElementById("viewer");
  viewer.innerHTML="";

  const img=document.createElement("img");
  img.src=movies[currentIndex].Poster;
  img.className="poster";
  viewer.appendChild(img);

  document.getElementById("status").innerHTML=
    `<div class="status ${movies[currentIndex].watched?"watched":"not-watched"}">
    ${movies[currentIndex].watched?"VU":"Ã€ VOIR"}
    </div>`;

  checkBackToFuture();
}

function toggleWatched(){
  if(!movies.length) return;
  movies[currentIndex].watched=!movies[currentIndex].watched;
  save();
  render();
}

function next(){
  if(!movies.length) return;
  currentIndex=(currentIndex+1)%movies.length;
  render();
}

function prev(){
  if(!movies.length) return;
  currentIndex=(currentIndex-1+movies.length)%movies.length;
  render();
}

function removeMovie(){
  movies.splice(currentIndex,1);
  currentIndex=0;
  save();
  render();
}

function save(){
  localStorage.setItem("movies",JSON.stringify(movies));
}

/* SWIPE */
document.addEventListener("touchstart",e=>{
  startX=e.touches[0].clientX;
});

document.addEventListener("touchend",e=>{
  let endX=e.changedTouches[0].clientX;
  if(endX-startX>50) prev();
  if(startX-endX>50) next();
});

/* EASTER EGG */

function checkBackToFuture(){
  const movie=movies[currentIndex];
  if(movie.Title.toLowerCase().includes("retour vers le futur")){
    launchDelorean();
  }
}

function launchDelorean(){
  if(document.querySelector(".delorean")) return;

  const car=document.createElement("img");
  car.src="https://upload.wikimedia.org/wikipedia/commons/2/20/Delorean_DMC-12_side.jpg";
  car.className="delorean";
  document.body.appendChild(car);

  setTimeout(()=>{car.style.top="65vh";},50);

  setTimeout(()=>{createFire();},800);

  car.onclick=()=>{
    showFlash();
    activateMessage();
    car.remove();
    removeFire();
  };
}

function createFire(){
  const left=document.createElement("div");
  left.className="fire";
  left.style.left="45%";

  const right=document.createElement("div");
  right.className="fire";
  right.style.left="55%";

  document.body.appendChild(left);
  document.body.appendChild(right);
}

function removeFire(){
  document.querySelectorAll(".fire").forEach(f=>f.remove());
}

function showFlash(){
  const flash=document.createElement("div");
  flash.className="flash";
  document.body.appendChild(flash);
  setTimeout(()=>flash.remove(),400);
}

function activateMessage(){
  document.body.classList.add("blur");

  const msg=document.createElement("div");
  msg.className="message";
  msg.innerText="Tu as trÃ¨s bon goÃ»t";
  document.body.appendChild(msg);

  msg.onclick=()=>{
    document.body.classList.remove("blur");
    msg.remove();
  };
}

render();
</script>

</body>
</html>
